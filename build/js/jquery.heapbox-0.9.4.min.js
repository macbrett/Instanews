"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,i,n){function s(t,i){this.element=t,this.options=e.extend({},h,i),this._defaults=h,this._name=o,this.instance,this.callbackManager=new Array,this.elem_isVisible="",this.init()}var a,o="heapbox",h={effect:{type:"slide",speed:"slow"},insert:"before",heapsize:n,emptyMessage:"Empty",tabindex:"undefined",title:n,showFirst:!0,inheritVisibility:!0,openStart:function(){},openComplete:function(){},closeStart:function(){},closeComplete:function(){},onChange:function(){}};s.prototype=(a={init:function(){this._hideSourceElement(),this._isSourceSelectbox(),this.instance=this.createInstance(),this._createElements(),this._setDefaultValues()},createInstance:function(){return{heapId:e(this.element).attr("id")||Math.round(99999999*Math.random()),state:!1}},_setEvents:function(){var t=this;this._setControlsEvents(),e(i).on("click","html",function(e){e.stopPropagation(),t._closeheap(!0,function(){},function(){})})},_setSliderEvents:function(){var t=this;this.scrollingStatus=!1,heap=e("#heapbox_"+this.instance.heapId+" .heap"),heap.find(".sliderDown").click(function(e){e.preventDefault(),e.stopPropagation(),t._setHeapboxFocus()}),heap.find(".sliderDown").mousedown(function(i){t.scrollingStatus=!0,t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"down"),t.interval=setInterval(function(){t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"down")},300)}).mouseup(function(e){clearInterval(t.interval),t.scrollingStatus=!1}).mouseout(function(e){clearInterval(t.interval),t.scrollingStatus=!1}),heap.find(".sliderUp").click(function(e){e.preventDefault(),e.stopPropagation(),t._setHeapboxFocus()}),heap.find(".sliderUp").mousedown(function(i){t.scrollingStatus=!0,t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"up"),t.interval=setInterval(function(){t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"up")},300)}).mouseup(function(e){clearInterval(t.interval),t.scrollingStatus=!1}).mouseout(function(e){clearInterval(t.interval),t.scrollingStatus=!1})},_setViewPosition:function(t){heap=e("div#heapbox_"+this.instance.heapId+" .heap"),heap.show();selected=t.find(".heapOptions li a.selected"),firstTop=t.find(".heapOptions li a").first().offset().top,actTop=e(selected).offset().top,newTop=firstTop-actTop+this.sliderUpHeight,heapHeight=e("div#heapbox_"+this.instance.heapId+" .heapOptions").height(),maxPosition=heapHeight-parseInt(this.options.heapsize,10)+this.sliderDownHeight,minPosition=0+this.sliderUpHeight,-1*newTop>maxPosition&&(newTop=-1*maxPosition),t.find(".heapOptions").css("top",newTop),this.instance.state||heap.hide()},_setKeyboardEvents:function(){var t=this;heapbox=e("#heapbox_"+this.instance.heapId),heapbox.keydown(function(i){switch(i.which){case 13:return t._handlerClicked(),!1;case 27:t._closeheap();break;case 37:t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"up"),i.preventDefault();break;case 39:t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"down"),i.preventDefault();break;case 38:t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"up"),i.preventDefault();break;case 40:t._keyArrowHandler(e("#heapbox_"+t.instance.heapId),"down"),i.preventDefault()}})},_setMouseWheelEvents:function(){var t=e("div#heapbox_"+this.instance.heapId+" .handler"),i=t.find("div.heap");t.on("mousewheel",function(e,t){e.preventDefault(),t==-1?i.find(".sliderDown").mousedown().mouseup():i.find(".sliderUp").mousedown().mouseup()})},_keyArrowHandler:function(t,i){var n=this,s=!1;t.find("div.heap ul li").each(function(){if(e(this).find("a").hasClass("selected")&&(s=!0,selectItem="down"==i?n._findNext(e(this)):n._findPrev(e(this)),selectItem))return n._heapChanged(n,selectItem,!0),!1}),0==s&&(selectItem=e("div#heapbox_"+n.instance.heapId+" .heapOptions .heapOption").first().find("a").addClass("selected"),n._heapChanged(n,selectItem,!0)),n._setViewPosition(e("#heapbox_"+n.instance.heapId))}},_defineProperty(a,"_setMouseWheelEvents",function(){var t=e("div#heapbox_"+this.instance.heapId),i=t.find("div.heap");t.on("mousewheel",function(e,t){e.preventDefault(),t==-1?i.find(".sliderDown").mousedown().mouseup():i.find(".sliderUp").mousedown().mouseup()})}),_defineProperty(a,"_findPrev",function(e){if(e.prev().length>0)return e.prev().find("a").hasClass("disabled")?this._findPrev(e.prev()):e.prev().find("a")}),_defineProperty(a,"_findNext",function(e){if(e.next().length>0)return e.next().find("a").hasClass("disabled")?this._findNext(e.next()):e.next().find("a")}),_defineProperty(a,"_createElements",function(){var t=this;heapBoxEl=e("<div/>",{id:"heapbox_"+this.instance.heapId,class:"heapBox",data:{sourceElement:this.element}}),1==t.options.inheritVisibility&&0==t.elem_isVisible&&heapBoxEl.css("display","none"),heapBoxHolderEl=e("<a/>",{href:"",class:"holder"}),heapBoxHandlerEl=e("<a/>",{href:"",class:"handler"}),heapBoxheapEl=e("<div/>",{class:"heap"}),heapBoxEl.append(heapBoxHolderEl),heapBoxEl.append(heapBoxHandlerEl),heapBoxEl.append(heapBoxheapEl),this.heapBoxEl=heapBoxEl,this._insertHeapbox(this.heapBoxEl)}),_defineProperty(a,"_insertHeapbox",function(t){switch(this.isSourceElementSelect&&"inside"==this.options.insert&&(this.options.insert="before"),this.options.insert){case"before":e(this.element).before(t);break;case"after":e(this.element).after(t);break;case"inside":e(this.element).html(t),this._showSourceElement();break;default:e(this.element).before(t)}}),_defineProperty(a,"_setDefaultValues",function(){this._initHeap(),this._initView(heapBoxEl),this._setHolderTitle(),this._setTabindex(),this._setEvents(),this._handleFirst()}),_defineProperty(a,"_setHeapboxFocus",function(){heapbox=e("div#heapbox_"+this.instance.heapId+" .handler"),heapbox.focus()}),_defineProperty(a,"_setHeapSize",function(){if(this.options.heapsize){if(heapBoxheapEl.height()<parseInt(this.options.heapsize,10))return void delete this.options.heapsize;heapBoxheapEl.css("height",this.options.heapsize)}}),_defineProperty(a,"_initHeap",function(){var e;this.isSourceElementSelect&&(e=this._optionsToJson(),this._setData(e))}),_defineProperty(a,"_initView",function(e){this._isHeapEmpty()||this._setViewPosition(e)}),_defineProperty(a,"_handleFirst",function(){this.options.showFirst||e("div#heapbox_"+this.instance.heapId+" .heapOptions .heapOption").first().remove()}),_defineProperty(a,"_setHolderTitle",function(){holderEl=e("#heapbox_"+this.instance.heapId).find(".holder"),selectedEl=e("#heapbox_"+this.instance.heapId).find(".heap ul li a.selected").last(),0!=selectedEl.length?(this.options.title?holderEl.text(this.options.title):holderEl.text(selectedEl.text()),holderEl.attr("rel",selectedEl.attr("rel")),selectedEl.attr("data-icon-src")&&(iconEl=this._createIconElement(selectedEl.attr("data-icon-src")),holderEl.append(iconEl))):(holderEl.text(this.options.emptyMessage),this._removeHeapboxHolderEvents(),this._removeHeapboxHandlerEvents())}),_defineProperty(a,"_setTabindex",function(){var t;t="undefined"!=this.options.tabindex?this.options.tabindex:e(this.element).attr("tabindex"),"undefined"!=t&&e("#heapbox_"+this.instance.heapId).attr("tabindex",t)}),_defineProperty(a,"_setData",function(t){var i=this,n=jQuery.parseJSON(t),s=!1;heapBoxheapOptionsEl=e("<ul/>",{class:"heapOptions"}),e.each(n,function(){this.selected&&(s=!0),heapBoxOptionLiEl=e("<li/>",{class:"heapOption"}),heapBoxheapOptionAEl=e("<a/>",{href:"",rel:this.value,title:this.text,text:this.text,class:this.selected?"selected":"",click:function(e){e.preventDefault(),e.stopPropagation(),i._heapChanged(i,this)}}),this.disabled&&(heapBoxheapOptionAEl.unbind("click"),heapBoxheapOptionAEl.addClass("disabled"),heapBoxheapOptionAEl.click(function(e){e.preventDefault(),e.stopPropagation()})),this.icon&&(heapBoxheapOptionAEl.attr("data-icon-src",this.icon),heapBoxOptionIcon=i._createIconElement(this.icon),heapBoxheapOptionAEl.append(heapBoxOptionIcon)),heapBoxOptionLiEl.append(heapBoxheapOptionAEl),heapBoxheapOptionsEl.append(heapBoxOptionLiEl)}),e("div#heapbox_"+this.instance.heapId+" .heap ul").remove(),e("div#heapbox_"+this.instance.heapId+" .heap").append(heapBoxheapOptionsEl),this._setHeapSize(),this._isHeapsizeSet()&&(this._createSliderUpElement(),this._createSliderDownElement()),1!=s&&e("div#heapbox_"+this.instance.heapId+" .heap ul li a").first().addClass("selected")}),_defineProperty(a,"_createSliderUpElement",function(){slideUp=e("<a/>",{class:"sliderUp",href:""}),e("div#heapbox_"+this.instance.heapId+" .heap .heapOptions").before(slideUp),sliderUp=e("#heapbox_"+this.instance.heapId+" .sliderUp"),this.sliderUpHeight=parseInt(sliderUp.css("height"),10)+parseInt(sliderUp.css("border-top-width"),10)+parseInt(sliderUp.css("border-bottom-width"),10),e("#heapbox_"+this.instance.heapId+" .heapOptions").css("top",this.sliderUpHeight)}),_defineProperty(a,"_createSliderDownElement",function(){slideDown=e("<a/>",{class:"sliderDown",href:""}),e("div#heapbox_"+this.instance.heapId+" .heap .heapOptions").after(slideDown),sliderDown=e("#heapbox_"+this.instance.heapId+" .sliderDown"),this.sliderDownHeight=parseInt(sliderDown.css("height"),10)+parseInt(sliderDown.css("border-top-width"))+parseInt(sliderDown.css("border-bottom-width"))}),_defineProperty(a,"_createIconElement",function(t){return heapBoxOptionIcon=e("<img/>",{src:t,alt:t}),heapBoxOptionIcon}),_defineProperty(a,"_optionsToJson",function(){var t=[];e(this.element).find("option").each(function(){t.push({value:e(this).attr("value"),text:e(this).text(),icon:e(this).attr("data-icon-src"),disabled:e(this).attr("disabled"),selected:e(this).is(":selected")?"selected":""})});var i=JSON.stringify(t);return i}),_defineProperty(a,"_heapboxToJson",function(){var t=[];e("div#heapbox_"+this.instance.heapId+" .heap ul li a").each(function(){t.push({value:e(this).attr("rel"),text:e(this).text(),selected:e(this).is(":selected")?"selected":""})});var i=JSON.stringify(t);return i}),_defineProperty(a,"_isHeapEmpty",function(){var t=e("div#heapbox_"+this.instance.heapId+" .heap ul li").length;return 0==t}),_defineProperty(a,"_setControlsEvents",function(){this._isHeapEmpty()||(this._setHeapboxHolderEvents(),this._setHeapboxHandlerEvents(),this._setKeyboardEvents(),this._setSliderEvents(),"object"==_typeof(e.event.special.mousewheel)&&this._setMouseWheelEvents())}),_defineProperty(a,"_isSourceSelectbox",function(){this.isSourceElementSelect=e(this.element).is("select")}),_defineProperty(a,"_isHeapsizeSet",function(){return!!this.options.heapsize}),_defineProperty(a,"_refreshSourceSelectbox",function(t){var i=this,n=!1;e(this.element).find("option").remove(),e.each(t,function(){option=e("<option/>",{value:this.value,text:this.text}),this.selected&&(option.attr("selected","selected"),n=!0),e(i.element).append(option)}),1!=n&&e(i.element).find("option").first().attr("selected","selected")}),_defineProperty(a,"_setSelectedOption",function(t){this._deselectSelectedOptions(),e(this.element).val(t),e(this.element).find("option[value='"+t+"']").attr("selected","selected")}),_defineProperty(a,"_deselectSelectedOptions",function(){select=e(this.element).find("option"),select.each(function(){e(this).removeAttr("selected")})}),_defineProperty(a,"_setHeapboxHolderEvents",function(){var t=this;heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.find(".holder").click(function(e){e.preventDefault(),e.stopPropagation(),t._setHeapboxFocus(),t._handlerClicked()})}),_defineProperty(a,"_setHeapboxHandlerEvents",function(){var t=this;heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.find(".handler").click(function(e){e.preventDefault(),e.stopPropagation(),t._setHeapboxFocus(),t._handlerClicked()})}),_defineProperty(a,"_removeHeapboxHolderEvents",function(){heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.find(".holder").unbind("click"),heapBoxEl.find(".holder").click(function(e){e.preventDefault()}),heapBoxEl.unbind("keydown")}),_defineProperty(a,"_removeHeapboxHandlerEvents",function(){heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.find(".handler").unbind("click"),heapBoxEl.find(".handler").click(function(e){e.preventDefault()})}),_defineProperty(a,"_handlerClicked",function(e){this.instance.state?this._closeheap():e?this._openheap():this._closeOthers()}),_defineProperty(a,"_heapChanged",function(t,i,n){n||this._closeheap(!0,function(){},function(){}),this._setSelected(e(i)),this._setHolderTitle(),this._setHeapboxFocus(),this._setSelectedOption(e(i).attr("rel")),this.options.onChange(e(i).attr("rel"),e(this.element))}),_defineProperty(a,"_setSelected",function(e){this._deselectAll(),e.addClass("selected")}),_defineProperty(a,"_deselectAll",function(t){heapLinks=e("#heapbox_"+this.instance.heapId).find(".heap ul li a"),heapLinks.each(function(){e(this).removeClass("selected")})}),_defineProperty(a,"_closeheap",function(t,i,n){if(heapEl=e("#heapbox_"+this.instance.heapId).removeClass("open").find(".heap"),heapEl.is(":animated")&&!t)return!1;switch(this.instance.state=!1,t?(i=i,n=n):(i=this.options.closeStart,n=this.options.closeComplete),i.call(),this.options.effect.type){case"fade":heapEl.fadeOut(this.options.effect.speed,n);break;case"slide":heapEl.slideUp(this.options.effect.speed,n);break;case"standard":heapEl.css("display","none"),n.call();break;default:heapEl.slideUp(this.options.effect.speed,n)}}),_defineProperty(a,"_openheap",function(){if(this._isHeapsizeSet()&&this._setViewPosition(e("div#heapbox_"+this.instance.heapId)),heapEl=e("#heapbox_"+this.instance.heapId).addClass("open").find(".heap"),heapEl.is(":animated"))return!1;switch(this.instance.state=!0,this.options.openStart.call(),this.options.effect.type){case"fade":heapEl.fadeIn(this.options.effect.speed,this.options.openComplete);break;case"slide":heapEl.slideDown(this.options.effect.speed,this.options.openComplete);break;case"standard":heapEl.css("display","block"),this.options.openComplete.call();break;default:heapEl.slideDown(this.options.effect.speed,this.options.openComplete)}}),_defineProperty(a,"_closeOthers",function(){var t=this;e("div[id^=heapbox_]").each(function(i){el=e("div#"+e(this).attr("id")),el.data("sourceElement")&&(sourceEl=e.data(this,"sourceElement"),heapBoxInst=e.data(sourceEl,"plugin_"+o),t.instance.heapId!=heapBoxInst.instance.heapId&&heapBoxInst.instance.state&&(t._callbackManager("change","_closeOthers",!0),heapBoxInst._closeheap(!0,function(){},function(){t._callbackManager("change","_closeOthers",!1)})))}),t._callbackManager("test","_closeOthers")}),_defineProperty(a,"_callbackManager",function(e,t,i){this.callbackManager[t]||(this.callbackManager[t]=0),"change"==e?(i?this.callbackManager[t]++:this.callbackManager[t]--,this._callbackManager("test",t)):"test"==e&&0==this.callbackManager[t]&&this._handlerClicked(!0)}),_defineProperty(a,"set",function(e){this._setData(e),this._setHolderTitle(),this._setEvents()}),_defineProperty(a,"select",function(t){heapBoxEl=e("div#heapbox_"+this.instance.heapId),this._heapChanged(this,heapBoxEl.find('.heapOptions [rel="'+t+'"]'))}),_defineProperty(a,"update",function(){this._setDefaultValues()}),_defineProperty(a,"_hideSourceElement",function(){this.elem_isVisible=e(this.element).is(":visible"),e(this.element).css("display","none")}),_defineProperty(a,"_showSourceElement",function(){e(this.element).css("display","block")}),_defineProperty(a,"hide",function(){e("div#heapbox_"+this.instance.heapId).css("visibility","hidden")}),_defineProperty(a,"show",function(){e("div#heapbox_"+this.instance.heapId).css("visibility","visible")}),_defineProperty(a,"disable",function(){return heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.addClass("disabled"),this._removeHeapboxHandlerEvents(),this._removeHeapboxHolderEvents(),this}),_defineProperty(a,"enable",function(){return heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.removeClass("disabled"),this._setEvents(),this}),_defineProperty(a,"_remove",function(){heapBoxEl=e("div#heapbox_"+this.instance.heapId),heapBoxEl.remove(),this._showSourceElement()}),a),e.fn[o]=function(t,i){return this.each(function(){if(e.data(this,"plugin_"+o))switch(heapBoxInst=e.data(this,"plugin_"+o),t){case"select":heapBoxInst.select(i);break;case"update":heapBoxInst.update();break;case"set":heapBoxInst.set(i);break;case"hide":heapBoxInst.hide();break;case"show":heapBoxInst.show();break;case"disable":heapBoxInst.disable();break;case"enable":heapBoxInst.enable();break;case"remove":heapBoxInst._remove()}else e.data(this,"plugin_"+o,new s(this,t))})}}(jQuery,window,document);